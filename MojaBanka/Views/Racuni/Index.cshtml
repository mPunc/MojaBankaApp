@model IEnumerable<MojaBanka.Models.Racun>
@using MojaBanka.Models
@{
    ViewBag.Title = "Računi";
    Layout = "~/Views/Shared/_Layout.cshtml";
    List<Klijent> klijenti = ViewBag.Klijenti;
}

<h2>Lista računa</h2>
@if (User.IsInRole(MojaBanka.Models.OvlastiKorisnik.Administrator))
{
    <p>
        @Html.ActionLink("Dodaj novi račun", "Create", null, new { @class = "btn btn-outline-success" })
    </p>

}

<div class="d-flex align-items-center gap-2">
    <input id="oib-polje" type="text" class="form-control d-inline-block" placeholder="Upišite OIB">
    <button class="btn btn-outline-primary" onclick="mojSearch()">Traži</button>
    <button class="btn btn-outline-primary" onclick="prikaziSve()">Prikaži sve</button>
</div>

<table class="table">
    <tr>
        <th>
            OIB klijenta
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Stanje_racun)
        </th>
        <th></th>
    </tr>

@foreach (var item in Model)
{
    <tr class="moji-podaci">
        <td class="oib-p">
            @{
                Klijent trenutni = klijenti.FirstOrDefault(x => x.Id_klijent == item.Id_klijent);
            }
            @Html.DisplayFor(modelItem => trenutni.Oib_klijent)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Stanje_racun)
        </td>
        <td>
            <span>
                @Html.ActionLink("Detalji", "Details", new { id = item.Id_racun }, new { @class = "btn btn-sm btn-outline-primary" })
            </span>
            @if (User.IsInRole(MojaBanka.Models.OvlastiKorisnik.Administrator))
            {
                <span>
                    @Html.ActionLink("Ažuriraj", "Edit", new { id = item.Id_racun }, new { @class = "btn btn-sm btn-outline-primary" })
                </span>
                <span>
                    @Html.ActionLink("Izbriši", "Delete", new { id = item.Id_racun }, new { @class = "btn btn-sm btn-outline-danger" })
                </span>
            }
        </td>
    </tr>
}

</table>

<script>
    function mojSearch() {
        var rezultat = document.getElementsByClassName("moji-podaci");

        var oib_t = document.getElementById("oib-polje").value.toString();

        for (var i = 0; i < rezultat.length; i++)
        {
            var trenutni_oib = rezultat[i].querySelectorAll(".oib-p").item(0);
            if (!trenutni_oib.innerHTML.trim().includes(oib_t, 0)) {
                rezultat[i].setAttribute("hidden", true);
            }
            else {
                rezultat[i].removeAttribute("hidden");
            }
        }
    }

    function prikaziSve() {
        var rezultat = document.getElementsByClassName("moji-podaci");
        for (var i = 0; i < rezultat.length; i++) {
            rezultat[i].removeAttribute("hidden");
        }
    }
</script>
